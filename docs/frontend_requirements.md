# フロントエンド要件定義書

## 1. システム概要

### 1.1 目的
リサイクル／資源管理システムのフロントエンド実装において、Next.js App RouterとApollo Clientを使用して、効率的で使いやすいウェブインターフェースを提供する。

### 1.2 技術スタック
- Next.js 14+ (App Router)
- Apollo Client
- TypeScript
- TailwindCSS
- Jest + React Testing Library
- MSW (モックサーバー)

## 2. 機能要件

### 2.1 認証・認可
- Auth0を使用したOIDC認証
- JWTトークンによるHasura GraphQL APIアクセス
- ロールベースのアクセス制御
- 2要素認証サポート

### 2.2 計量チケット管理
#### 機能
- リアルタイム重量表示（WebSocket）
- チケット作成・編集・キャンセル
- 写真・ID書類のアップロード
- QRコード生成・印刷
- フィルタリング・ソート機能付きチケット一覧

#### UI要件
- ダッシュボード形式のメイン画面
- 重量値のリアルタイム更新表示
- 入力フォームのバリデーション
- ステータスに応じた色分け表示
- レスポンシブデザイン対応

### 2.3 在庫管理
#### 機能
- 在庫ロットの追跡・管理
- 在庫移動記録
- QRコードスキャン連携
- 在庫レポート生成

#### UI要件
- 在庫状況の視覚的表示（チャート/グラフ）
- ドラッグ&ドロップによる在庫移動
- フィルター機能付き在庫一覧
- エクスポート機能

### 2.4 注文管理
#### 機能
- 購買/販売オーダーのライフサイクル管理
- 計量チケットとの連携
- 価格表参照・適用
- 承認ワークフロー

#### UI要件
- オーダー作成ウィザード
- ステータス進捗表示
- 関連ドキュメントのプレビュー
- 価格計算の自動更新

### 2.5 配送管理
#### 機能
- 配車計画作成
- ドライバー・車両割り当て
- リアルタイム位置追跡
- 配送ステータス更新

#### UI要件
- カレンダー形式のスケジュール表示
- マップ上での車両位置表示
- ドラッグ&ドロップによる配車割り当て
- モバイル対応UI

## 3. 技術要件

### 3.1 アプリケーションアーキテクチャ
```typescript
src/
  ├── app/               // App Router pages
  ├── components/        // Reactコンポーネント
  ├── features/         // 機能モジュール
  ├── graphql/          // GraphQL操作
  ├── hooks/            // カスタムフック
  ├── lib/              // ユーティリティ
  ├── providers/        // コンテキストプロバイダー
  └── types/            // 型定義
```

### 3.2 GraphQL統合
- Apollo Clientによるデータフェッチング
- コードファースト開発（GraphQL Codegen）
- キャッシュ戦略の実装
- エラーハンドリング

### 3.3 状態管理
- Apollo Clientキャッシュ
- Reactコンテキスト
- フォーム状態管理（React Hook Form）

### 3.4 パフォーマンス最適化
- SSR/SSG戦略
- 動的インポート
- 画像最適化
- キャッシュ制御

## 4. 品質要件

### 4.1 テスト戦略
- ユニットテスト（Jest）
- 統合テスト（React Testing Library）
- E2Eテスト（Playwright）
- APIモック（MSW）

### 4.2 パフォーマンス目標
- Lighthouse スコア
  - Performance: 90+
  - Accessibility: 95+
  - Best Practices: 95+
  - SEO: 90+
- First Contentful Paint: 1.5s以下
- Time to Interactive: 3.5s以下

### 4.3 アクセシビリティ
- WCAG 2.1レベルAA準拠
- キーボードナビゲーション
- スクリーンリーダー対応
- 高コントラストモード

## 5. 開発プロセス

### 5.1 開発フロー
1. 機能単位のブランチ作成
2. TDDアプローチでの実装
3. コードレビュー
4. 自動テスト実行
5. マージ＆デプロイ

### 5.2 CI/CD
- GitHub Actionsによる自動化
- テスト自動実行
- コードクオリティチェック
- 自動デプロイ

## 6. 環境構築

### 6.1 開発環境
```bash
# 必要なパッケージのインストール
npm install

# 開発サーバー起動
npm run dev

# テスト実行
npm test

# ビルド
npm run build
```

### 6.2 環境変数
```env
NEXT_PUBLIC_HASURA_API_URL=
NEXT_PUBLIC_AUTH0_DOMAIN=
NEXT_PUBLIC_AUTH0_CLIENT_ID=
NEXT_PUBLIC_AUTH0_AUDIENCE=
```

## 7. 今後の展望

### 7.1 Phase 1（初期リリース）
- 基本的なCRUD機能
- 認証・認可
- レスポンシブデザイン

### 7.2 Phase 2（機能拡張）
- リアルタイム更新
- オフライン対応
- パフォーマンス最適化

### 7.3 Phase 3（高度な機能）
- AIによる予測分析
- カスタムレポート
- サードパーティ連携